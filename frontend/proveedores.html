<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Proveedores - Multimotos 3.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{ --azul:#102962; --gris:#f4f4f4; --blanco:#ffffff; --azulClaro:#e9eef9; }
    body{ background:var(--gris); }
    .page-title{ color:var(--azul); font-weight:800; }
    .card{ border-radius:1rem; border:0; box-shadow:0 10px 25px rgba(16,41,98,.08); }
    .nav-pills .nav-link.active{ background:var(--azul); }
    .btn-primary{ background:var(--azul); border-color:var(--azul); }
    .table thead th{ background:var(--azulClaro); color:#1a2b6d; }
    .badge-soft{ background:var(--azulClaro); color:#102962; font-weight:600; border-radius:50rem; padding:.35rem .6rem; }
    .tbl-actions button{ margin-right:.25rem; }
    .toolbar{ display:flex; gap:.5rem; align-items:center; }
    .toolbar .btn{ border-radius:.5rem; }
    .table-hover>tbody>tr:hover{ background:#f9fbff; }
    .toast-container{ position: fixed; top: 1rem; right: 1rem; z-index: 1080; }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="page-title mb-3">Proveedores</h1>

    <ul class="nav nav-pills mb-3">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-prov">Proveedores</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-comp">Compras</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-cxp">Cuentas por Pagar</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-pagos">Pagos</button></li>
    </ul>

    <div class="tab-content">
      <!-- Proveedores -->
      <div class="tab-pane fade show active" id="tab-prov">
        <div class="card p-3 mb-3">
          <h5 class="mb-3">Nuevo proveedor</h5>
          <form id="formProveedor" class="row g-3">
            <div class="col-md-4"><label class="form-label">Nombre *</label><input class="form-control" name="nombre" required></div>
            <div class="col-md-2"><label class="form-label">RUC</label><input class="form-control" name="ruc"></div>
            <div class="col-md-3"><label class="form-label">Teléfono</label><input class="form-control" name="telefono"></div>
            <div class="col-md-3"><label class="form-label">Email</label><input class="form-control" name="email"></div>
            <div class="col-md-12"><label class="form-label">Dirección</label><input class="form-control" name="direccion"></div>
            <div class="col-md-12"><button class="btn btn-primary">Guardar</button></div>
          </form>
        </div>
        <div class="card p-3">
          <h5 class="mb-3">Listado de proveedores</h5>
          <div class="table-responsive">
            <table class="table table-sm table-striped table-hover" id="tablaProveedores">
              <thead><tr><th>#</th><th>Nombre</th><th>RUC</th><th>Teléfono</th><th>Email</th><th>Dirección</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Compras -->
      <div class="tab-pane fade" id="tab-comp">
        <div class="card p-3 mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-1">Compras</h5>
              <div class="text-muted small">Gestiona tus compras, edita ítems y registra pagos sin salir de esta sección.</div>
            </div>
            <div class="toolbar">
              <button class="btn btn-outline-primary btn-sm" id="btnNuevaCompra">Nueva compra</button>
              <button class="btn btn-outline-primary btn-sm" id="btnCruceVentas">Cruce de ventas</button>
            </div>
          </div>
        </div>
        <div class="card p-3">
          <div class="table-responsive">
            <table class="table table-sm table-striped table-hover align-middle" id="tablaCompras">
              <thead>
                <tr>
                  <th>ID</th><th>Proveedor</th><th># Factura</th><th>Fecha</th>
                  <th>Condición</th><th>Total</th><th>Abonado</th><th>Saldo</th>
                  <th>Estado</th><th class="text-end">Acciones</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- CxP -->
      <div class="tab-pane fade" id="tab-cxp">
        <div class="card p-3">
          <h5 class="mb-3">Cuentas por Pagar</h5>
          <div class="table-responsive">
            <table class="table table-sm table-striped table-hover" id="tablaCXP">
              <thead><tr><th>Compra</th><th>Proveedor</th><th># Factura</th><th>Fecha</th><th>Total</th><th>Abonado</th><th>Saldo</th><th>Estado</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Pagos (sección existente) -->
      <div class="tab-pane fade" id="tab-pagos">
        <div class="card p-3">
          <h5 class="mb-3">Registrar pago a proveedor</h5>
          <form id="formPago" class="row g-3">
            <div class="col-md-3"><label class="form-label">Compra (ID) *</label><input class="form-control" name="compra_id" type="number" required></div>
            <div class="col-md-3"><label class="form-label">Fecha *</label><input class="form-control" name="fecha" type="date" required></div>
            <div class="col-md-3"><label class="form-label">Tipo de pago</label><input class="form-control" name="tipo_pago"></div>
            <div class="col-md-3"><label class="form-label">Monto *</label><input class="form-control" name="monto" type="number" step="0.01" required></div>
            <div class="col-md-12"><label class="form-label">Observaciones</label><input class="form-control" name="observaciones"></div>
            <div class="col-md-12"><button class="btn btn-primary">Guardar pago</button></div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Cruce de ventas -->
  <div class="modal fade" id="modalCruce" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Cruce de ventas (rubros vendidos)</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3 mb-3">
            <div class="col-md-3"><label class="form-label">Desde</label><input type="date" id="fDesde" class="form-control"></div>
            <div class="col-md-3"><label class="form-label">Hasta</label><input type="date" id="fHasta" class="form-control"></div>
            <div class="col-md-3 d-flex align-items-end"><button class="btn btn-primary w-100" id="btnTraerVentas">Traer ventas</button></div>
            <div class="col-md-3 d-flex align-items-end">
              <div class="form-check ms-auto"><input class="form-check-input" type="checkbox" id="chkTodos"><label class="form-check-label" for="chkTodos">Seleccionar todo</label></div>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-sm table-striped" id="tablaVentas">
              <thead><tr><th></th><th>Fecha</th><th>Descripción</th><th>Cant.</th><th>Precio compra</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-primary" id="btnCargarAFactura">Cargar a factura</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Datos de la compra (crear/editar) -->
  <div class="modal fade" id="modalNuevaCompra" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Factura de compra</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <form id="formCompra" class="row g-3">
            <div class="col-md-6"><label class="form-label">Proveedor *</label><select class="form-select" name="proveedor_id" id="selProveedor" required></select></div>
            <div class="col-md-3"><label class="form-label"># Factura</label><input class="form-control" name="numero_factura"></div>
            <div class="col-md-3"><label class="form-label">Fecha *</label><input class="form-control" name="fecha_recepcion" type="date" required></div>
            <div class="col-md-3"><label class="form-label">Condición *</label>
              <select class="form-select" name="condicion_pago" required>
                <option value="Contado">Contado</option>
                <option value="Crédito">Crédito</option>
              </select>
            </div>
            <div class="col-md-9"><label class="form-label">Observaciones</label><input class="form-control" name="observaciones"></div>
          </form>

          <hr>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Ítems de la compra</h6>
            <button class="btn btn-outline-primary btn-sm" id="btnAddItem">Agregar ítem manual</button>
          </div>

          <div class="table-responsive">
            <table class="table table-sm align-middle" id="tablaItemsCompra">
              <thead><tr><th style="min-width: 320px;">Descripción</th><th style="min-width: 90px;">Cant.</th><th style="min-width: 120px;">Precio compra</th><th style="min-width: 120px;">Subtotal</th><th></th></tr></thead>
              <tbody></tbody>
              <tfoot><tr><th colspan="3" class="text-end">Total</th><th id="totalCompra">$0.00</th><th></th></tr></tfoot>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button class="btn btn-outline-primary" id="btnAbrirPagosDesdeCompra">Pagos</button>
          <button class="btn btn-primary" id="btnGuardarCompra">Guardar compra</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Detalle de compra (ver/editar) -->
  <div class="modal fade" id="modalCompraDetalle" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Detalle de compra</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <form id="formCompraEdit" class="row g-3">
            <input type="hidden" id="compraEditId">
            <div class="col-md-4"><label class="form-label">Proveedor</label><select class="form-select" id="selProveedorEdit"></select></div>
            <div class="col-md-2"><label class="form-label"># Factura</label><input class="form-control" id="numeroFacturaEdit"></div>
            <div class="col-md-3"><label class="form-label">Fecha</label><input class="form-control" id="fechaEdit" type="date"></div>
            <div class="col-md-3"><label class="form-label">Condición</label>
              <select class="form-select" id="condicionEdit">
                <option value="Contado">Contado</option>
                <option value="Crédito">Crédito</option>
              </select>
            </div>
            <div class="col-md-12"><label class="form-label">Observaciones</label><input class="form-control" id="obsEdit"></div>
          </form>
          <hr>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Ítems</h6>
            <button class="btn btn-outline-primary btn-sm" id="btnAddItemEdit">Agregar ítem</button>
          </div>
          <div class="table-responsive">
            <table class="table table-sm align-middle" id="tablaItemsEdit">
              <thead><tr><th>Descripción</th><th>Cant.</th><th>Precio</th><th>Subtotal</th><th></th></tr></thead>
              <tbody></tbody>
              <tfoot><tr><th colspan="3" class="text-end">Total</th><th id="totalEdit">$0.00</th><th></th></tr></tfoot>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <div class="me-auto"><span class="badge-soft" id="estadoEdit">Estado</span></div>
          <button class="btn btn-outline-primary" id="btnAbrirPagosDesdeDetalle">Pagos</button>
          <button class="btn btn-primary" id="btnGuardarEdit">Guardar cambios</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Pagos (embebido) -->
  <div class="modal fade" id="modalPagos" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Pagos de compra <span id="pagosCompraId"></span></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <form id="formPagoModal" class="row g-3">
            <input type="hidden" name="compra_id" id="pagoCompraIdHidden">
            <div class="col-md-3"><label class="form-label">Fecha *</label><input class="form-control" name="fecha" id="pagoFecha" type="date" required></div>
            <div class="col-md-3"><label class="form-label">Tipo de pago</label><input class="form-control" name="tipo_pago" id="pagoTipo"></div>
            <div class="col-md-3"><label class="form-label">Monto *</label><input class="form-control" name="monto" id="pagoMonto" type="number" step="0.01" required></div>
            <div class="col-md-3"><label class="form-label">Obs.</label><input class="form-control" name="observaciones" id="pagoObs"></div>
          </form>
          <div class="text-end"><button class="btn btn-primary btn-sm" id="btnGuardarPagoModal">Guardar pago</button></div>
          <hr>
          <h6 class="mb-2">Historial de pagos</h6>
          <div class="table-responsive">
            <table class="table table-sm table-striped" id="tablaAbonos">
              <thead><tr><th>#</th><th>Fecha</th><th>Monto</th><th>Tipo</th><th>Obs.</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div class="toast-container">
    <div id="toastOk" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toastOkMsg">Operación exitosa</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
    <div id="toastErr" class="toast align-items-center text-bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toastErrMsg">Ocurrió un error</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/proveedores.js"></script>
</body>
</html>
