<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Comisiones - Multimotos 2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f5f7fb; }
    .card { border:0; border-radius:18px; box-shadow:0 8px 26px rgba(16,41,98,.08); }
    .card h5 { color:#102962; font-weight:800; }
    .pill { padding:.35rem .6rem; border-radius:999px; font-size:.75rem; }
    .pill.ingreso{ background:#e8f5e9; color:#102962; }
    .pill.descuento{ background:#ffebee; color:#c62828; }
    .table thead th { position: sticky; top:0; background:#102962; color:#fff; }
    .modal-header { border:0; }
    .totals span { font-weight:700; color:#102962; }
  </style>
</head>
<body class="py-4">
  <div class="container-xxl">
    <h2 class="mb-4 fw-bold" style="color:#102962">Módulo de Comisiones</h2>

    <!-- Filtros -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Filtros</h5>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Mecánico</label>
            <select id="mecanico" class="form-select"></select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Desde</label>
            <input type="date" id="desde" class="form-control" />
          </div>
          <div class="col-md-3">
            <label class="form-label">Hasta</label>
            <input type="date" id="hasta" class="form-control" />
          </div>
          <div class="col-md-2 d-grid">
            <label class="form-label">&nbsp;</label>
            <button id="btnCalcular" class="btn btn-primary fw-bold" style="background:#102962;border:0">Calcular</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Comisiones encontradas -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Comisiones de Mano de Obra (pendientes en el rango)</h5>
        <div class="table-responsive" style="max-height: 300px;">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>#</th>
                <th>Fecha</th>
                <th>Descripción</th>
                <th class="text-end">Base</th>
                <th class="text-end">%</th>
                <th class="text-end">Comisión</th>
              </tr>
            </thead>
            <tbody id="tbodyRegistros"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Rubros adicionales -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Ingresos / Descuentos</h5>
        <div class="row g-3 align-items-end">
          <div class="col-md-2">
            <label class="form-label">Tipo</label>
            <select id="rTipo" class="form-select">
              <option value="INGRESO">Ingreso</option>
              <option value="DESCUENTO">Descuento</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Concepto</label>
            <select id="rConcepto" class="form-select">
              <option>Alimentación</option>
              <option>Comisiones anticipadas</option>
              <option>Créditos cedidos</option>
              <option>Sueldo fijo</option>
              <option>Otros</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Descripción</label>
            <input id="rDescripcion" class="form-control" placeholder="Detalle (opcional)"/>
          </div>
          <div class="col-md-2">
            <label class="form-label">Fecha</label>
            <input id="rFecha" type="date" class="form-control"/>
          </div>
          <div class="col-md-2">
            <label class="form-label">Monto</label>
            <input id="rMonto" type="number" min="0" step="0.01" class="form-control"/>
          </div>
          <div class="col-md-12 d-grid d-md-block">
            <button id="btnAgregarRubro" class="btn btn-outline-primary mt-2" style="border-color:#102962;color:#102962">Agregar</button>
          </div>
        </div>

        <div class="table-responsive mt-3" style="max-height: 220px;">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Tipo</th>
                <th>Concepto</th>
                <th>Descripción</th>
                <th>Fecha</th>
                <th class="text-end">Monto</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tbodyRubros"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Resumen -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Resumen</h5>
        <div class="row g-3 totals">
          <div class="col-md-3"><div>Comisiones: <span id="tCom"></span></div></div>
          <div class="col-md-3"><div>Ingresos: <span id="tIng"></span></div></div>
          <div class="col-md-3"><div>Descuentos: <span id="tDes"></span></div></div>
          <div class="col-md-3"><div>Neto a pagar: <span id="tNeto"></span></div></div>
          <div class="col-12">
            <label class="form-label mt-2">Observaciones</label>
            <textarea id="observaciones" class="form-control" rows="2" placeholder="Opcional"></textarea>
          </div>
          <div class="col-12 d-grid">
            <button id="btnGenerar" class="btn btn-success fw-bold">Generar Liquidación</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Histórico -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Histórico de Liquidaciones</h5>
        <div class="table-responsive" style="max-height: 320px;">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>N°</th>
                <th>Fecha</th>
                <th>Mecánico</th>
                <th>Desde</th>
                <th>Hasta</th>
                <th class="text-end">Comisiones</th>
                <th class="text-end">Ingresos</th>
                <th class="text-end">Descuentos</th>
                <th class="text-end">Neto</th>
              </tr>
            </thead>
            <tbody id="tbodyHistorial"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalResumen" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Resumen de Liquidación</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body" id="modalContenido"></div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button class="btn btn-primary" id="btnConfirmar" style="background:#102962;border:0">Confirmar</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./js/comisiones.js"></script>
</body>
</html>
